<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <!-- PWA Configuration -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="DUKOPS">
    <title>SISTEM PELAPORAN DUKOPS BABINSA dan JADWAL PIKET KORAMIL</title>
    <meta name="theme-color" content="#202624">

    <!-- ========== FAVICON ========== -->
    <link rel="icon" type="image/png" href="favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="manifest" href="site.webmanifest" />
    <!-- ============================= -->

    <!-- External Libraries -->
    <script
        src="https://cdn.polyfill.io/v3/polyfill.min.js?features=default,es6,Promise,fetch,Array.prototype.includes"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Main Stylesheet (Modularized) -->
    <link rel="stylesheet" href="css/main.css">

    <!-- Legacy Stylesheet (Fallback) -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- ================= SPLASH SCREEN ================= -->
    <div id="splashScreen" class="splash-container">
        <!-- Logo Kodam Udayana -->
        <div class="splash-circle">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/commons/2/25/Lambang_Kodam_Udayana.svg"
                    alt="Lambang Kodam Udayana" class="svg-logo">
            </div>
        </div>

        <!-- Teks Aplikasi -->
        <div class="splash-title">DUKOPS BABINSA dan JADWAL PIKET</div>
        <div class="splash-unit">KORAMIL 1609-05/SUKASADA</div>
        <div class="splash-subtitle">KODIM 1609/BULELENG</div>

        <!-- Progress Bar -->
        <div class="splash-progress-container">
            <div class="splash-progress-bar" id="splashProgressBar"></div>
            <div class="progress-percentage" id="progressPercentage">0%</div>
        </div>

        <!-- Loading Text -->
        <div class="loading-text" id="loadingStatusText">Memuat aplikasi...</div>
    </div>

    <!-- ================= APLIKASI UTAMA ================= -->
    <div id="appContainer" class="container" style="display: none;">
        <!-- Network Status Indicator -->
        <div id="networkStatus" class="network-status network-online" title="Terhubung ke internet">
            <i class="fas fa-wifi"></i>
            <span>Online</span>
            <span class="queue-badge" style="display: none;">0</span>
        </div>

        <!-- Install Button -->
        <button id="installButton">
            <i class="fas fa-download"></i> Install App
        </button>

        <!-- Navigation Buttons -->
        <div class="nav-buttons">
            <button class="nav-btn nav-btn-dukops active on" id="btnDukops" onclick="showDukops()">
                <i class="fas fa-file-upload"></i> DUKOPS
                <span class="tab-status">ON</span>
            </button>
            <button class="nav-btn nav-btn-piket off" id="btnJadwal" onclick="showJadwalPiket()">
                <i class="fas fa-calendar-alt"></i> PIKET
                <span class="tab-status">OFF</span>
            </button>
        </div>

        <!-- DUKOPS Content -->
        <div id="dukopsContent">
            <div style="width: 90%; margin: 0 auto; font-size: 12px;">
                <div class="header-container">
                    <img id="desaHeaderImage"
                        src="https://github.com/Koramil05/DUKOPS/blob/main/Profile/profile_default.png?raw=true"
                        alt="Header Desa" class="header-image"
                        onerror="this.src='https://github.com/Koramil05/DUKOPS/blob/main/Profile/profile_default.png?raw=true'">
                    <div class="header-text">
                        <div class="header-title">DUKOPS BABINSA</div>
                        <div class="header-title">KORAMIL 1609-05/SUKASADA</div>
                        <div class="header-subtitle">Jl. Jelantik Gingsir No. 32 Sukasada Singaraja-Bali 81161</div>
                        <div>
                            <div class="counter-value" id="submissionCounter">0</div>
                        </div>
                    </div>
                </div>

                <!-- Row 1: Pilih Desa & Foto -->
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-village"></i> Pilih Desa:</label>
                        <select id="selectDesa" onchange="loadSelectedDesa()">
                            <option value="">-- Pilih Desa --</option>
                        </select>
                        <div id="selectDesaError" class="form-error"></div>
                        <div id="loadingDesa"><i class="fas fa-spinner fa-spin"></i> Memuat daftar desa/Kelurahan...
                        </div>
                        <div class="previewBox" id="previewDesa" style="display: none;"></div>

                        <div id="loadingKoordinat" style="display: none;"><i class="fas fa-spinner fa-spin"></i> Memuat
                            koordinat...</div>
                        <div class="previewBox" id="previewKordinat" style="display: none;"></div>
                    </div>

                    <div class="form-col">
                        <label><i class="fas fa-camera"></i> Foto Kegiatan:</label>
                        <input type="file" id="gambar" accept="image/*" onchange="previewImage()">
                        <div id="gambarError" class="form-error"></div>
                        <div id="fileSizeInfo" style="display: none; margin-top: 4px;"></div>
                        <div class="previewBox" id="previewGambar"></div>
                    </div>
                </div>

                <!-- Row 2: Tanggal & Waktu & Reset Button -->
                <div class="form-row">
                    <div class="form-col">
                        <label><i class="fas fa-calendar-alt"></i> Tanggal & Waktu:</label>
                        <input type="datetime-local" id="tanggalWaktu" onchange="updateDatePreview()">
                        <div id="tanggalWaktuError" class="form-error"></div>
                        <div class="previewBox" id="previewTanggal" style="display: none;"></div>
                    </div>

                    <div class="form-col form-col-reset">
                        <label><i class="fas fa-redo"></i> Aksi:</label>
                        <button id="resetBtn" onclick="resetAll()" class="reset-btn">
                            <i class="fas fa-redo"></i> Reset Semua
                        </button>
                    </div>
                </div>

                <!-- Row 3: Narasi Kegiatan dengan Preview Tanggal -->
                <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; gap: 15px;">
                    <label style="margin: 0; flex: 1;"><i class="fas fa-file-alt"></i> Narasi Kegiatan:</label>
                    <span id="narasiCounter" style="display: none;">0/500</span>
                    <div id="previewTanggalHeader" class="preview-tanggal-box"></div>
                </div>
                <textarea id="narasi" rows="4" placeholder="Masukan narasi kegiatan..."
                    oninput="checkInputCompletion()"></textarea>
                <div id="narasiError" class="form-error"></div>

                <canvas id="canvas"></canvas>

                <button id="submitBtn" onclick="processSubmission()" disabled>
                    <i class="fas fa-download"></i> DOWNLOAD & <i class="fas fa-paper-plane"></i> KIRIM & <i
                        class="fab fa-google-drive"></i> DRIVE
                </button>

                <button id="showAttendanceBtn" onclick="showAttendance()">
                    <i class="fas fa-chart-bar"></i> TAMPILKAN LAPORAN
                </button>

                <div id="attendancePanel" style="display: none;">
                    <div class="attendance-header">
                        <h3 style="color: #9fd49f; margin: 0;"><i class="fas fa-file-alt"></i> LAPORAN TERKIRIM</h3>
                        <button onclick="hideAttendance()"
                            style="background: #9fd49f; border: none; color: #f5f5f5; cursor: pointer; font-size: 20px;">
                            <i class="">EXIT LAPORAN TERKIRIM</i>
                        </button>
                    </div>

                    <div class="attendance-filters">
                        <select id="attendanceDesaFilter" onchange="loadAttendanceData()">
                            <option value="">Semua Desa</option>
                        </select>
                        <input type="month" id="attendanceMonthFilter" onchange="loadAttendanceData()">
                    </div>

                    <div id="attendanceLoading" style="display: none; text-align: center; padding: 20px;">
                        <i class="fas fa-spinner fa-spin"></i> ðŸª– Sistem sedang menyiapkan laporan...
                    </div>

                    <div id="attendanceSummary" class="attendance-summary" style="display: none;">
                        <div class="summary-row">
                            <span>Total Laporan:</span>
                            <span id="totalReports" style="font-weight: bold; color: #9fd49f;">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Total Desa:</span>
                            <span id="totalDesa" style="font-weight: bold; color: #9fd49f;">0</span>
                        </div>
                        <div class="summary-row">
                            <span>Pencapaian Target:</span>
                            <span id="targetStatus" style="font-weight: bold;">0%</span>
                        </div>
                        <div class="progress-container">
                            <div id="progressBar" class="progress-bar"></div>
                        </div>
                    </div>

                    <div id="attendanceList" style="max-height: 400px; overflow-y: auto;"></div>

                    <div class="attendance-actions">
                        <button onclick="refreshAttendanceData()" style="background: #3a4f41;">
                            <i class="fas fa-sync-alt"></i> Refresh Data
                        </button>
                        <button onclick="downloadAttendanceReport()" style="background: #2b4d2b;">
                            <i class="fas fa-download"></i> Download Laporan
                        </button>
                    </div>
                </div>

                <div id="logTerkirim"></div>
            </div>
        </div>

        <!-- Jadwal Piket Content -->
        <div id="jadwalPiketContainer" style="display: none;">
            <div class="jadwal-header">
                <h1 class="jadwal-title">JADWAL PIKET</h1>
                <div class="app-logo-container">
                    <img src="https://github.com/Koramil05/JADWAL/raw/main/LOGO%20KOREM163%20Wirasatya.png"
                        alt="Logo Korem 163 Wirasatya" class="jadwal-logo">
                </div>
                <p>KORAMIL 1609-05/SUKASADA<br>Kodim 1609/Buleleng</p>
            </div>

            <button class="jadwal-btn" onclick="resetJadwalData()">
                <i class="fas fa-sync-alt"></i> RESSET ULANG JADWAL PIKET
            </button>

            <!-- KORAMIL -->
            <div class="jadwal-section">
                <div class="section-content">
                    <div>
                        <h3 class="section-title-koramil">Piket Koramil Hari Ini : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama1a">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama1b">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="section-title-koramil">Piket Koramil Besok : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama2a">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama2b">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KEDIAMAN -->
            <div class="jadwal-section">
                <div class="section-content">
                    <div>
                        <h3 class="section-title-kediaman">Jaga Kediaman Hari Ini : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama3a">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama3b">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="section-title-kediaman">Jaga Kediaman Besok : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama3c">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama3d">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- MAKODIM -->
            <div class="jadwal-section">
                <div class="section-content">
                    <div>
                        <h3 class="section-title-makodim">Piket Makodim Hari ini : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama4a">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama4b">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="section-title-makodim">Piket Makodim Besok : </h3>
                        <div class="row">
                            <div class="col">
                                <select id="j_nama4c">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                            <div class="col">
                                <select id="j_nama4d">
                                    <option value="" enabled selected>&lt;Pilih Nama&gt;</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Telegram Group Selector -->
            <div class="telegram-group-selector">
                <label for="j_telegramGroupSelect"><i class="fab fa-telegram"></i> Group Telegram Tujuan:</label>
                <select id="j_telegramGroupSelect">
                    <option value="-1003020813628" selected>Auto terkirim ke-Group Telegram ( KORAMIL 05)</option>
                </select>
            </div>

            <!-- Tombol untuk mengirim pesan ke WhatsApp dan Telegram -->
            <button class="jadwal-btn" onclick="shareJadwalToBothPlatforms()">
                <div class="icon-container">
                    <div class="whatsapp-icon">
                        <i class="fab fa-whatsapp"></i>
                    </div>
                    <div class="telegram-icon">
                        <i class="fab fa-telegram"></i>
                    </div>
                </div>
                <span class="platform-name">WHATSAPP & TELEGRAM</span>
                <span class="platform-desc">Klik untuk kirim pesan</span>
            </button>

            <!-- PREVIEW PESAN -->
            <div class="jadwal-section">
                <textarea id="j_hasilPesan" readonly
                    placeholder="Preview pesan akan muncul di sini setelah memilih nama..."></textarea>
            </div>

            <div class="app-loading" id="j_loadingIndicator">
                <i class="fas fa-spinner fa-spin"></i>
            </div>
        </div>

        <!-- Toast Notification for Jadwal Piket -->
        <div class="jadwal-toast" id="j_toastNotification"></div>
    </div>

    <!-- Application Scripts -->
    <!-- Modern ES6 Modules (New Structure) -->
    <script type="module" src="js/index.js"></script>

    <!-- Legacy Scripts (Backward Compatibility) -->
    <script src="app.js"></script>
</body>

</html>